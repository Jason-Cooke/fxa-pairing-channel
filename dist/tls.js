!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("tls",[],n):"object"==typeof exports?exports.tls=n():t.tls=n()}(window,function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=14)}([function(t,n,e){t.exports=e(12)},function(t,n){function e(t,n,e,r,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void e(t)}u.done?n(s):Promise.resolve(s).then(r,i)}t.exports=function(t){return function(){var n=this,r=arguments;return new Promise(function(i,o){var a=t.apply(n,r);function u(t){e(a,i,o,u,s,"next",t)}function s(t){e(a,i,o,u,s,"throw",t)}u(void 0)})}}},function(t,n){t.exports=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}},function(t,n){function e(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}},function(t,n){function e(n){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(n)}t.exports=e},function(t,n,e){var r=e(8),i=e(9);t.exports=function(t,n){return!n||"object"!==r(n)&&"function"!=typeof n?i(t):n}},function(t,n,e){var r=e(11);t.exports=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&r(t,n)}},function(t,n,e){e(4);var r=e(10);function i(n,e,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,n,e){var i=r(t,n);if(i){var o=Object.getOwnPropertyDescriptor(i,n);return o.get?o.get.call(e):o.value}},i(n,e,o||n)}t.exports=i},function(t,n){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(n){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=r=function(t){return e(t)}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},r(n)}t.exports=r},function(t,n){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,n,e){var r=e(4);t.exports=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=r(t)););return t}},function(t,n){function e(n,r){return t.exports=e=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},e(n,r)}t.exports=e},function(t,n,e){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e(13),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(t){r.regeneratorRuntime=void 0}},function(t,n){!function(n){"use strict";var e,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",c="object"==typeof t,f=n.regeneratorRuntime;if(f)c&&(t.exports=f);else{(f=n.regeneratorRuntime=c?t.exports:{}).wrap=x;var h="suspendedStart",p="suspendedYield",l="executing",y="completed",v={},d={};d[a]=function(){return this};var w=Object.getPrototypeOf,g=w&&w(w(I([])));g&&g!==r&&i.call(g,a)&&(d=g);var m=O.prototype=b.prototype=Object.create(d);_.prototype=m.constructor=O,O.constructor=_,O[s]=_.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===_||"GeneratorFunction"===(n.displayName||n.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(m),t},f.awrap=function(t){return{__await:t}},S(L.prototype),L.prototype[u]=function(){return this},f.AsyncIterator=L,f.async=function(t,n,e,r){var i=new L(x(t,n,e,r));return f.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},S(m),m[s]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},f.keys=function(t){var n=[];for(var e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},f.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,i){return u.type="throw",u.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=n,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),v},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),R(e),v}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var i=r.arg;R(e)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}}}function x(t,n,e,r){var i=n&&n.prototype instanceof b?n:b,o=Object.create(i.prototype),a=new P(r||[]);return o._invoke=function(t,n,e){var r=h;return function(i,o){if(r===l)throw new Error("Generator is already running");if(r===y){if("throw"===i)throw o;return M()}for(e.method=i,e.arg=o;;){var a=e.delegate;if(a){var u=j(a,e);if(u){if(u===v)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(r===h)throw r=y,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r=l;var s=k(t,n,e);if("normal"===s.type){if(r=e.done?y:p,s.arg===v)continue;return{value:s.arg,done:e.done}}"throw"===s.type&&(r=y,e.method="throw",e.arg=s.arg)}}}(t,e,a),o}function k(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}function b(){}function _(){}function O(){}function S(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function L(t){var n;this._invoke=function(e,r){function o(){return new Promise(function(n,o){!function n(e,r,o,a){var u=k(t[e],t,r);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(t){n("next",t,o,a)},function(t){n("throw",t,o,a)}):Promise.resolve(c).then(function(t){s.value=t,o(s)},function(t){return n("throw",t,o,a)})}a(u.arg)}(e,r,n,o)})}return n=n?n.then(o,o):o()}}function j(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=k(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function E(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function R(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function I(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:M}}function M(){return{value:e,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(t,n,e){"use strict";e.r(n);var r=e(5),i=e.n(r),o=e(4),a=e.n(o),u=e(7),s=e.n(u),c=e(6),f=e.n(c),h=e(0),p=e.n(h),l=e(1),y=e.n(l),v=e(2),d=e.n(v),w=e(3),g=e.n(w);function m(t,n){if(!t)throw new Error("assert failed: "+n)}function x(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"value must be a Uint8Array";return m(t instanceof Uint8Array,n),t}function k(t){return Array.prototype.map.call(t,function(t){var n=t.toString(16);return 1===n.length&&(n="0"+n),n}).join("")}function b(t){return m(t.length%2==0,"hexstr.length must be even"),new Uint8Array(Array.prototype.map.call(t,function(n,e){return e%2==1?t[e-1]+n:""}).filter(function(t){return!!t}).map(function(t){return parseInt(t,16)}))}function _(t){return new TextDecoder("utf-8").decode(t)}function O(t){return new TextEncoder("utf-8").encode(t)}function S(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}var L=function(){function t(){d()(this,t)}return g()(t,null,[{key:"read",value:function(){var t=y()(p.a.mark(function t(n,e){var r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n.readUint16(),n.expectStr("CH"),m(S(n.readBytes(r-2),e),"unexpected pskID");case 4:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=y()(p.a.mark(function t(n,e){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.writeUint16(e.byteLength+2),n.writeStr("CH"),n.writeBytes(e);case 3:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()}]),t}(),j=function(){function t(){d()(this,t)}return g()(t,null,[{key:"read",value:function(){var t=y()(p.a.mark(function t(n,e){var r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n.readUint16(),n.expectStr("SH"),m(S(n.readBytes(r-2),e),"unexpected pskID");case 4:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=y()(p.a.mark(function t(n,e){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.writeUint16(e.byteLength+2),n.writeStr("SH"),n.writeBytes(e);case 3:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()}]),t}(),E=function(){function t(){d()(this,t)}return g()(t,null,[{key:"read",value:function(){var t=y()(p.a.mark(function t(n){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(8===n.readUint16(),"incorrect Finished length"),n.expectStr("FINISHED");case 2:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=y()(p.a.mark(function t(n){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.writeUint16(8),n.writeStr("FINISHED");case 2:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()}]),t}(),R=function(){function t(){d()(this,t)}return g()(t,null,[{key:"read",value:function(){var t=y()(p.a.mark(function t(n){var e;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.readUint16(),n.expectStr("AD"),t.abrupt("return",n.readBytes(e-2));case 3:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"write",value:function(){var t=y()(p.a.mark(function t(n,e){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.writeUint16(e.byteLength+2),n.writeStr("AD"),n.writeBytes(e);case 3:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()}]),t}(),P=function(){function t(n){d()(this,t),this.conn=n}return g()(t,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"maybeRecv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.conn._hasIncomingMessage()){t.next=4;break}return t.next=3,this.recv();case 3:return t.abrupt("return",t.sent);case 4:return t.abrupt("return",null);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(!1,"not implemented");case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}(),I=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(!1,"uninitialized state");case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(!1,"uninitialized state");case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(!1,"uninitialized state");case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m(!1,"uninitialized state");case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),M=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(n){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.error=n;case 1:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw this.error;case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw this.error;case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"maybeRecv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw this.error;case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw this.error;case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),z=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send();case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=y()(p.a.mark(function t(){var n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.conn._pendingSendData.length>0)){t.next=8;break}return n=this.conn._pendingSendData.shift(),t.next=4,this.conn._addOutgoingMessage(R,n);case 4:return t.next=6,this.conn._flushOutgoingRecords();case 6:t.next=0;break;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._getIncomingMessage(R);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),T=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._addOutgoingMessage(L,this.conn.pskID);case 2:return t.next=4,this.conn._flushOutgoingRecords();case 4:return t.next=6,this.conn._transition(U);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),U=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._getIncomingMessage(j,this.conn.pskID);case 2:return t.next=4,this.conn._transition(D);case 4:return t.abrupt("return",this.conn._state.maybeRecv());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),D=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._transition(A);case 2:return t.abrupt("return",this.conn._state.maybeRecv());case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),A=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._getIncomingMessage(E);case 2:return t.next=4,this.conn._addOutgoingMessage(E);case 4:return t.next=6,this.conn._flushOutgoingRecords();case 6:return t.next=8,this.conn._transition(z);case 8:return t.abrupt("return",this.conn._state.maybeRecv());case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),B=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._getIncomingMessage(L,this.conn.pskID);case 2:return t.next=4,this.conn._transition(N);case 4:return t.abrupt("return",this.conn._state.maybeRecv());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),N=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._transition(F);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),F=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._addOutgoingMessage(j,this.conn.pskID);case 2:return t.next=4,this.conn._addOutgoingMessage(E);case 4:return t.next=6,this.conn._flushOutgoingRecords();case 6:return t.next=8,this.conn._transition(C);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),C=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"initialize",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._transition(G);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),G=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,[{key:"recv",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.conn._getIncomingMessage(E);case 2:return t.next=4,this.conn._transition(z);case 4:return t.abrupt("return",this.conn._state.maybeRecv());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),n}(P),H=function(){function t(){d()(this,t),this.EMPTY=new Uint8Array(0),this.pending=[],this.head=this.EMPTY,this.i=0}return g()(t,[{key:"append",value:function(t){x(t),this.head===this.EMPTY?(this.head=t,this.i=0):this.pending.push(t)}},{key:"hasMoreBytes",value:function(){return this.head!==this.EMPTY&&this.i<this.head.byteLength}},{key:"_incr",value:function(t){this.i+=t,m(this.i<=this.head.byteLength,"should not have read past end of buffer"),this.i==this.head.byteLength&&(this.i=0,this.pending.length>0?this.head=this.pending.unshift():this.head=this.EMPTY)}},{key:"readBytes",value:function(t){var n=new Uint8Array(this.head.buffer,this.head.byteOffset+this.i,t);return this._incr(t),n}},{key:"expectBytes",value:function(t){var n=this.readBytes(t.byteLength);m(S(n,t),"unexpected data: ".concat(n," !== ").concat(t))}},{key:"expectStr",value:function(t){this.expectBytes(O(t))}},{key:"readUint16",value:function(t){return t=this.head[this.i]<<8|this.head[this.i+1],this._incr(2),t}}]),t}(),Y=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:65535;d()(this,t),this.i=0,this.size=n,this.buf=new Uint8Array(n)}return g()(t,[{key:"_incr",value:function(t){this.i+=t,m(this.i<=this.size,"do not write past end of buffer")}},{key:"writeBytes",value:function(t){x(t),this.buf.set(t,this.i),this._incr(t.byteLength)}},{key:"writeStr",value:function(t){this.writeBytes(O(t))}},{key:"writeUint16",value:function(t){this.buf[this.i]=t>>8,this.buf[this.i+1]=255&t,this._incr(2)}},{key:"finalize",value:function(){return new Uint8Array(this.buf.buffer,0,this.i)}}]),t}();e.d(n,"InsecureClientConnection",function(){return J}),e.d(n,"InsecureServerConnection",function(){return K}),e.d(n,"bytesToHex",function(){return k}),e.d(n,"hexToBytes",function(){return b}),e.d(n,"bytesToUtf8",function(){return _}),e.d(n,"utf8ToBytes",function(){return O});var q=function(){function t(n,e,r){d()(this,t),this.psk=x(n),this.pskID=x(e),this.sendCallback=r,this._state=new I(this),this._pendingSendData=[],this._incomingRecords=new H,this._outgoingRecords=new Y,this._lastPromise=Promise.resolve()}return g()(t,[{key:"send",value:function(){var t=y()(p.a.mark(function t(n){var e=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x(n),t.next=3,this._serialize(y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e._pendingSendData.push(n),t.next=3,e._state.send();case 3:case"end":return t.stop()}},t,this)})));case 3:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"recv",value:function(){var t=y()(p.a.mark(function t(n){var e=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x(n),t.next=3,this._serialize(y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e._incomingRecords.append(n),t.next=3,e._state.recv();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)})));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"close",value:function(){var t=y()(p.a.mark(function t(){var n=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._serialize(y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._state.close();case 2:case"end":return t.stop()}},t,this)})));case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_serialize",value:function(t){var n=this;return this._lastPromise=this._lastPromise.then(function(){return t()}).catch(function(){var t=y()(p.a.mark(function t(e){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._transition(M,e);case 2:throw e;case 3:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()),this._lastPromise}},{key:"_transition",value:function(){var t=y()(p.a.mark(function t(n){var e,r,i,o,a=arguments;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(this._state=new n(this),r=a.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=a[o];return t.next=4,(e=this._state).initialize.apply(e,i);case 4:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_addOutgoingMessage",value:function(){var t=y()(p.a.mark(function t(n){var e,r,i,o=arguments;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=o.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=o[i];return t.next=3,n.write.apply(n,[this._outgoingRecords].concat(r));case 3:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_flushOutgoingRecords",value:function(){var t=y()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendCallback(this._outgoingRecords.finalize());case 2:this._outgoingRecords=new Y;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_hasIncomingMessage",value:function(){return this._incomingRecords.hasMoreBytes()}},{key:"_getIncomingMessage",value:function(){var t=y()(p.a.mark(function t(n){var e,r,i,o=arguments;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=o.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=o[i];return t.next=3,n.read.apply(n,[this._incomingRecords].concat(r));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()}],[{key:"create",value:function(){var t=y()(p.a.mark(function t(n,e,r){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new this(n,e,r));case 1:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()}]),t}(),J=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,null,[{key:"create",value:function(){var t=y()(p.a.mark(function t(e,r,i){var o;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s()(a()(n),"create",this).call(this,e,r,i);case 2:return o=t.sent,t.next=5,o._transition(T);case 5:return t.abrupt("return",o);case 6:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()}]),n}(q),K=function(t){function n(){return d()(this,n),i()(this,a()(n).apply(this,arguments))}return f()(n,t),g()(n,null,[{key:"create",value:function(){var t=y()(p.a.mark(function t(e,r,i){var o;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s()(a()(n),"create",this).call(this,e,r,i);case 2:return o=t.sent,t.next=5,o._transition(B);case 5:return t.abrupt("return",o);case 6:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()}]),n}(q)}])});